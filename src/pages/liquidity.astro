---
import Layout from '../layouts/Layout.astro';
import { getLiquidityData, fetchOffers, satoshisToBtc, btcToXmr, formatPrice } from '../lib/liquidity';

const { chartSvg } = await getLiquidityData();
const offers = await fetchOffers();
---

<Layout title="Network Liquidity - eigenwallet">
  <div class="flex flex-col lg:flex-row gap-6 mb-12">
    <!-- Liquidity Chart -->
    <div class="flex-1 min-w-0">
      <div class="border border-[#333] bg-[#1e1e1e] h-full flex flex-col">
        <div class="p-4 flex-1">
          <Fragment set:html={chartSvg} />
        </div>
        <div class="border-t border-[#333] py-2 text-center">
          <span class="text-sm font-medium text-[#eee]">Network Liquidity</span>
        </div>
      </div>
    </div>

    <!-- Current Offers -->
    <div class="flex-1 min-w-0">
      <div class="border border-[#444] bg-[#1a1a1a] h-full flex flex-col">
        <div class="border-b border-[#333] px-6 py-3">
          <span class="text-sm font-medium text-[#eee]">Offers</span>
        </div>
        <div class="flex-1 overflow-auto divide-y divide-[#333]">
          {offers.length > 0 ? (
            offers.map((offer) => (
              <div class="px-6 py-3 hover:bg-[#222] transition-colors">
                <div class="flex items-baseline gap-2 text-[0.95rem] font-mono flex-wrap">
                  <span class="inline-flex items-baseline min-w-[80px] justify-end">
                    <span class="text-[#eee]">{btcToXmr(offer.minSwapAmount, offer.price)}</span>
                    <span class="text-[#eee] ml-1">XMR</span>
                  </span>
                  <span class="text-[#666]">–</span>
                  <span class="inline-flex items-baseline min-w-[90px]">
                    <span class="text-[#f7a41d] font-medium">{btcToXmr(offer.maxSwapAmount, offer.price)}</span>
                    <span class="text-[#f7a41d] ml-1">XMR</span>
                  </span>
                  <span class="text-gray-500 inline-flex items-baseline text-sm">
                    <span>(</span>
                    <span>{satoshisToBtc(offer.minSwapAmount)}</span>
                    <span class="mx-1">–</span>
                    <span>{satoshisToBtc(offer.maxSwapAmount)} BTC</span>
                    <span>)</span>
                  </span>
                  <span class="text-gray-500 text-sm ml-auto">
                    @ {formatPrice(offer.price)} BTC/XMR
                  </span>
                </div>
              </div>
            ))
          ) : (
            <div class="p-6 text-center">
              <p class="text-[#888]">No offers available at the moment.</p>
            </div>
          )}
        </div>
      </div>
    </div>
  </div>
</Layout>

